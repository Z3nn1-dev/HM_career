<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Admin Panel</title>
    <link rel="stylesheet" href="admin-styles.css">
</head>
<body>
    <div class="admin-container">
        <!-- Header -->
        <header class="admin-header">
            <h1>Live Chat Admin Panel</h1>
            <div class="admin-info">
                <span id="connectionStatus" class="status-indicator">Connecting...</span>
                <span id="adminName">Admin</span>
                <button id="logoutBtn" class="logout-btn" title="Logout">üö™ Logout</button>
            </div>
        </header>

        <!-- Admin Login -->
        <div id="adminLogin" class="admin-login">
            <div class="login-card">
                <h2>Admin Login</h2>
                <form id="loginForm">
                    <div class="form-group">
                        <label for="adminNameInput">Admin Name:</label>
                        <input type="text" id="adminNameInput" placeholder="Enter admin name..." required>
                    </div>
                    <div class="form-group">
                        <label for="adminPassword">Password:</label>
                        <input type="password" id="adminPassword" placeholder="Enter password..." required>
                    </div>
                    <button type="submit">Login as Admin</button>
                </form>
            </div>
        </div>

        <!-- Main Admin Panel -->
        <div id="adminPanel" class="admin-panel hidden">
            <!-- Sidebar -->
            <aside class="admin-sidebar">
                <nav class="admin-nav">
                    <button class="nav-btn active" data-tab="chat">
                        üí¨ Active Session
                    </button>
                    <button class="nav-btn" data-tab="sessions">
                        ÔøΩ Sessions (<span id="sessionCount">0</span>)
                    </button>
                    <button class="nav-btn" data-tab="closed">
                        üìã Closed Sessions (<span id="closedSessionCount">0</span>)
                    </button>
                    <button class="nav-btn" data-tab="settings">
                        ‚öôÔ∏è Settings
                    </button>
                </nav>
            </aside>

            <!-- Main Content -->
            <main class="admin-main">
                <!-- Chat Tab -->
                <div id="chatTab" class="admin-tab active">
                    <div class="tab-header">
                        <h2>Active Session</h2>
                        <div class="tab-actions">
                            <button id="closeSessionBtn" class="action-btn danger hidden">
                                ‚ùå Close Session
                            </button>
                            <button id="leaveSessionBtn" class="action-btn secondary hidden">
                                ‚¨ÖÔ∏è Leave Session
                            </button>
                        </div>
                    </div>
                    
                    <div class="session-info hidden" id="sessionInfo">
                        <div class="customer-info">
                            <span id="customerName">No active session</span>
                            <span id="sessionId" class="session-id"></span>
                        </div>
                        <div class="session-actions">
                            <button id="viewHistoryBtn" class="action-btn history-btn hidden" onclick="adminClient.viewClientHistory()">
                                üìö View History
                            </button>
                        </div>
                    </div>
                    
                    <div class="chat-monitor" id="chatMonitor">
                        <div class="no-session" id="noSessionMessage">
                            <h3>No Active Session</h3>
                            <p>Select a session from the Sessions tab to start helping a customer.</p>
                            <div style="margin-top: 15px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                                <button onclick="adminClient.forceLoadActiveSession()" style="padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                    üîÑ Force Load Active Session
                                </button>
                                <button onclick="adminClient.debugSession()" style="padding: 8px 16px; background: #f39c12; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                    üêõ Debug Session
                                </button>
                                <button onclick="adminClient.socket.emit('get_sessions')" style="padding: 8px 16px; background: #27ae60; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                    üìã Refresh Sessions
                                </button>
                            </div>
                        </div>
                        
                        <div class="messages-panel hidden" id="messagesPanel">
                            <div id="adminMessagesList" class="admin-messages-list"></div>
                        </div>
                        
                        <div class="admin-message-controls hidden" id="messageControls">
                            <input type="text" id="adminMessageInput" 
                                   placeholder="Type your message to the customer..." 
                                   maxlength="500">
                            <button id="sendAdminMessage">Send</button>
                        </div>
                    </div>
                </div>

                <!-- Sessions Tab -->
                <div id="sessionsTab" class="admin-tab">
                    <div class="tab-header">
                        <h2>Customer Sessions</h2>
                        <div class="tab-info">
                            <span>Active: <span id="activeSessionCount">0</span></span>
                            <span>Waiting: <span id="waitingSessionCount">0</span></span>
                        </div>
                    </div>
                    
                    <div class="sessions-panel">
                        <div id="sessionsList" class="sessions-list"></div>
                    </div>
                </div>

                <!-- Closed Sessions Tab -->
                <div id="closedTab" class="admin-tab">
                    <div class="tab-header">
                        <h2>Closed Sessions</h2>
                        <div class="tab-info">
                            <span>Total: <span id="closedSessionCount">0</span></span>
                            <button id="refreshClosedBtn" class="action-btn secondary">üîÑ Refresh</button>
                        </div>
                    </div>
                    
                    <div class="closed-sessions-panel">
                        <div id="closedSessionsList" class="sessions-list"></div>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div id="settingsTab" class="admin-tab">
                    <div class="tab-header">
                        <h2>Chat Settings</h2>
                    </div>
                    
                    <div class="settings-panel">
                        <div class="settings-group">
                            <h3>Server Information</h3>
                            <div class="info-grid">
                                <div class="info-item">
                                    <label>Server Status:</label>
                                    <span id="serverStatus" class="status-badge">Online</span>
                                </div>
                                <div class="info-item">
                                    <label>Uptime:</label>
                                    <span id="serverUptime">--</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="settings-group">
                            <h3>Quick Actions</h3>
                            <div class="actions-grid">
                                <button id="exportChatBtn" class="settings-btn">
                                    üì• Export Chat History
                                </button>
                                <button id="reloadServerBtn" class="settings-btn">
                                    üîÑ Refresh Connection
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Closed Session Viewer Modal -->
    <div id="closedSessionModal" class="modal hidden">
        <div class="modal-content large">
            <div class="modal-header">
                <h3>Closed Session History</h3>
                <button class="modal-close" id="closeClosedSessionModal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="closedSessionInfo" class="session-info-panel">
                    <div class="info-row">
                        <strong>Customer:</strong> <span id="closedCustomerName">-</span>
                    </div>
                    <div class="info-row">
                        <strong>Admin:</strong> <span id="closedAdminName">-</span>
                    </div>
                    <div class="info-row">
                        <strong>Started:</strong> <span id="closedSessionStart">-</span>
                    </div>
                    <div class="info-row">
                        <strong>Ended:</strong> <span id="closedSessionEnd">-</span>
                    </div>
                    <div class="info-row">
                        <strong>Messages:</strong> <span id="closedMessageCount">0</span>
                    </div>
                </div>
                <div id="closedMessagesContainer" class="closed-messages-container">
                    <div id="closedMessagesList" class="messages-list"></div>
                </div>
                <div class="modal-actions">
                    <button id="exportClosedSessionBtn" class="modal-btn secondary">
                        üì§ Export Chat
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- User Action Modal -->
    <div id="userActionModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>User Actions</h3>
                <button class="modal-close" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <p>User: <strong id="selectedUserName"></strong></p>
                <div class="modal-actions">
                    <button id="kickUserBtn" class="modal-btn danger">
                        ‚ö†Ô∏è Kick User
                    </button>
                    <button id="messageUserBtn" class="modal-btn primary">
                        üí¨ Send Private Message
                    </button>
                </div>
                <div id="kickReasonContainer" class="hidden">
                    <label for="kickReason">Kick Reason:</label>
                    <input type="text" id="kickReason" placeholder="Enter reason (optional)">
                    <button id="confirmKick" class="modal-btn danger">Confirm Kick</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://realtime-chat-a2ut.onrender.com/socket.io/socket.io.js"></script>
    <script src="admin.js"></script>
</body>
</html>

